<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ADMINISTRAÇÃO</title>
  <style>
    .add-product-container,
    .update-product-container {
      padding: 20px;
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      margin: 20px 0;
      max-width: 500px;
    }
    .add-product-container h2,
    .update-product-container h2 {
        margin-bottom: 20px;
    }
    .add-product-container label,
    .update-product-container label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
    }
    .add-product-container input,
    .update-product-container input,
    .add-product-container textarea,
    .update-product-container textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .add-product-container button,
    .update-product-container button {
        padding: 10px 20px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .add-product-container button:hover,
    .update-product-container button:hover {
        background-color: #218838;
    }
    .product-card {
      border: 1px solid #ddd;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      background-color: #fff;
    }
    .product-card img {
      max-width: 100px;
      height: auto;
      display: block;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <!-- Formulário de Adição de Produto -->
  <div class="add-product-container">
    <h2>Adicionar Novo Produto</h2>
    <form id="addProductForm">
        <label for="productId">ID do Produto:</label>
        <input type="number" id="productId" required>

        <label for="productName">Nome do Produto:</label>
        <input type="text" id="productName" required>

        <label for="productDescription">Descrição:</label>
        <textarea id="productDescription" required></textarea>

        <label for="productPrice">Preço:</label>
        <input type="number" id="productPrice" step="0.01" required>

        <label for="productImage">URL da Imagem:</label>
        <input type="text" id="productImage" required>

        <button type="submit">Adicionar Produto</button>
    </form>
  </div>

  <!-- Formulário de Atualização de Produto -->
  <div class="update-product-container">
    <h2>Atualizar Produto</h2>
    <form id="updateProductForm">
        <label for="updateProductId">ID do Produto:</label>
        <input type="number" id="updateProductId" required>

        <label for="updateProductName">Nome do Produto:</label>
        <input type="text" id="updateProductName" required>

        <label for="updateProductDescription">Descrição:</label>
        <textarea id="updateProductDescription" required></textarea>

        <label for="updateProductPrice">Preço:</label>
        <input type="number" id="updateProductPrice" step="0.01" required>

        <label for="updateProductImage">URL da Imagem:</label>
        <input type="text" id="updateProductImage" required>

        <button type="submit">Atualizar Produto</button>
    </form>
  </div>

  <div id="productResults"></div>

  <h1>Excluir Produto</h1>
  
  <form id="delete-form">
    <label for="product-id">ID do Produto:</label>
    <input type="number" id="product-id" name="product-id" required>
    <button type="submit">Excluir Produto</button>
  </form>
  
  <script>
    // Adicionar Produto
    document.getElementById('addProductForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const productId = document.getElementById('productId').value;
      const productName = document.getElementById('productName').value;
      const productDescription = document.getElementById('productDescription').value;
      const productPrice = document.getElementById('productPrice').value;
      const productImage = document.getElementById('productImage').value;

      const newProduct = {
          id: parseInt(productId),
          title: productName,
          description: productDescription,
          preco: parseFloat(productPrice),
          img: productImage
      };

      console.log('Enviando produto:', newProduct);

      fetch('http://localhost:3000/produtos', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(newProduct)
      })
      .then(response => response.json())
      .then(data => {
          console.log('Resposta da API:', data);
          alert('Produto adicionado com sucesso!');
          addProductToList(data);
          document.getElementById('addProductForm').reset();
      })
      .catch(error => {
          console.error('Erro ao adicionar o produto:', error);
      });
    });

    // Atualizar Produto
    document.getElementById('updateProductForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const productId = document.getElementById('updateProductId').value;
      const productName = document.getElementById('updateProductName').value;
      const productDescription = document.getElementById('updateProductDescription').value;
      const productPrice = document.getElementById('updateProductPrice').value;
      const productImage = document.getElementById('updateProductImage').value;

      const updatedProduct = {
          title: productName,
          description: productDescription,
          preco: parseFloat(productPrice),
          img: productImage
      };

      console.log('Atualizando produto com ID:', productId, updatedProduct);

      fetch(`http://localhost:3000/produtos/${productId}`, {
          method: 'PUT',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(updatedProduct)
      })
      .then(response => response.json())
      .then(data => {
          console.log('Resposta da API:', data);
          alert('Produto atualizado com sucesso!');
          updateProductInList(data);
          document.getElementById('updateProductForm').reset();
      })
      .catch(error => {
          console.error('Erro ao atualizar o produto:', error);
      });
    });

    // Atualizar produto na lista
    function updateProductInList(updatedProduct) {
      const productResults = document.getElementById('productResults');
      const productCards = productResults.getElementsByClassName('product-card');
      for (let card of productCards) {
        const id = card.dataset.id;
        if (parseInt(id) === updatedProduct.id) {
          card.querySelector('img').src = updatedProduct.img;
          card.querySelector('h3').textContent = updatedProduct.title;
          card.querySelector('p').textContent = updatedProduct.description;
          card.querySelector('p.price').textContent = `Preço: R$${updatedProduct.preco.toFixed(2)}`;
          break;
        }
      }
    }

    // Adicionar produto à lista
    function addProductToList(product) {
      const productResults = document.getElementById('productResults');
      const productCard = `
          <div class="product-card" data-id="${product.id}">
              <img src="${product.img}" alt="${product.title}">
              <h3>${product.title}</h3>
              <p>${product.description}</p>
              <p class="price">Preço: R$${product.preco.toFixed(2)}</p>
          </div>
      `;
      productResults.innerHTML += productCard;
    }

    // Excluir Produto
    document.getElementById('delete-form').addEventListener('submit', function(event) {
      event.preventDefault();

      const productId = document.getElementById('product-id').value;

      console.log('Excluindo produto com ID:', productId);

      fetch(`http://localhost:3000/produtos/${productId}`, {
        method: 'DELETE',
      })
        .then(response => {
          if (response.ok) {
            alert('Produto excluído com sucesso!');
            removeProductFromList(productId);
          } else {
            alert('Erro ao excluir o produto. Verifique se o ID está correto.');
          }
        })
        .catch(error => {
          console.error('Erro:', error);
        });
    });

    // Remover produto da lista
    function removeProductFromList(productId) {
      const productResults = document.getElementById('productResults');
      const productCards = productResults.getElementsByClassName('product-card');
      for (let card of productCards) {
        const id = card.dataset.id;
        if (parseInt(id) === parseInt(productId)) {
          productResults.removeChild(card);
          break;
        }
      }
    }
  </script>
</body>
</html>
